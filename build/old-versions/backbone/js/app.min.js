var app=app||{};!function(){"use strict";app.Todo=Backbone.Model.extend({defaults:{title:"",completed:!1},toggle:function(){this.save({completed:!this.get("completed")})}})}();
var app=app||{};!function(){"use strict";var Todos=Backbone.Collection.extend({model:app.Todo,localStorage:new Backbone.LocalStorage("todos-backbone"),completed:function(){return this.where({completed:!0})},remaining:function(){return this.where({completed:!1})},nextOrder:function(){return this.length?this.last().get("order")+1:1},comparator:"order"});app.todos=new Todos}();
var app=app||{};!function($){"use strict";app.TodoView=Backbone.View.extend({tagName:"li",template:_.template($("#item-template").html()),events:{"click .toggle":"toggleCompleted","dblclick label":"edit","click .destroy":"clear","keypress .edit":"updateOnEnter","keydown .edit":"revertOnEscape","blur .edit":"close"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"visible",this.toggleVisible)},render:function(){if(void 0===this.model.changed.id)return this.$el.html(this.template(this.model.toJSON())),this.$el.toggleClass("completed",this.model.get("completed")),this.toggleVisible(),this.$input=this.$(".edit"),this},toggleVisible:function(){this.$el.toggleClass("hidden",this.isHidden())},isHidden:function(){return this.model.get("completed")?"active"===app.TodoFilter:"completed"===app.TodoFilter},toggleCompleted:function(){this.model.toggle()},edit:function(){this.$el.addClass("editing"),this.$input.focus()},close:function(){var value=this.$input.val(),trimmedValue=value.trim();this.$el.hasClass("editing")&&(trimmedValue?this.model.save({title:trimmedValue}):this.clear(),this.$el.removeClass("editing"))},updateOnEnter:function(e){e.which===ENTER_KEY&&this.close()},revertOnEscape:function(e){e.which===ESC_KEY&&(this.$el.removeClass("editing"),this.$input.val(this.model.get("title")))},clear:function(){this.model.destroy()}})}(jQuery);
var app=app||{};!function($){"use strict";app.AppView=Backbone.View.extend({el:".todoapp",statsTemplate:_.template($("#stats-template").html()),events:{"keypress .new-todo":"createOnEnter","click .clear-completed":"clearCompleted","click .toggle-all":"toggleAllComplete"},initialize:function(){this.allCheckbox=this.$(".toggle-all")[0],this.$input=this.$(".new-todo"),this.$footer=this.$(".footer"),this.$main=this.$(".main"),this.$list=$(".todo-list"),this.listenTo(app.todos,"add",this.addOne),this.listenTo(app.todos,"reset",this.addAll),this.listenTo(app.todos,"change:completed",this.filterOne),this.listenTo(app.todos,"filter",this.filterAll),this.listenTo(app.todos,"all",_.debounce(this.render,0)),app.todos.fetch({reset:!0})},render:function(){var completed=app.todos.completed().length,remaining=app.todos.remaining().length;app.todos.length?(this.$main.show(),this.$footer.show(),this.$footer.html(this.statsTemplate({completed:completed,remaining:remaining})),this.$(".filters li a").removeClass("selected").filter('[href="#/'+(app.TodoFilter||"")+'"]').addClass("selected")):(this.$main.hide(),this.$footer.hide()),this.allCheckbox.checked=!remaining},addOne:function(todo){var view=new app.TodoView({model:todo});this.$list.append(view.render().el)},addAll:function(){this.$list.html(""),app.todos.each(this.addOne,this)},filterOne:function(todo){todo.trigger("visible")},filterAll:function(){app.todos.each(this.filterOne,this)},newAttributes:function(){return{title:this.$input.val().trim(),order:app.todos.nextOrder(),completed:!1}},createOnEnter:function(e){e.which===ENTER_KEY&&this.$input.val().trim()&&(app.todos.create(this.newAttributes()),this.$input.val(""))},clearCompleted:function(){return _.invoke(app.todos.completed(),"destroy"),!1},toggleAllComplete:function(){var completed=this.allCheckbox.checked;app.todos.each(function(todo){todo.save({completed:completed})})}})}(jQuery);
var app=app||{};!function(){"use strict";var TodoRouter=Backbone.Router.extend({routes:{"*filter":"setFilter"},setFilter:function(param){app.TodoFilter=param||"",app.todos.trigger("filter")}});app.TodoRouter=new TodoRouter,Backbone.history.start()}();
var app=app||{},ENTER_KEY=13,ESC_KEY=27;$(function(){"use strict";new app.AppView});